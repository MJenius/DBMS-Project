{% extends 'base.html' %}

{% block title %}Order {{ order.Order_ID if order else '' }}{% endblock %}

{% block content %}
  <h2 class="mb-3">Order Details</h2>

  {% if not order %}
    <div class="alert alert-warning">Order not found.</div>
  {% else %}
    <div class="card mb-3">
      <div class="card-body">
        <h5>Order #{{ order.Order_ID }}</h5>
        <p><strong>Customer:</strong> {{ order.First_Name }} {{ order.Last_Name }} {% if order.Phone %} - {{ order.Phone }}{% endif %}</p>
        <p><strong>Restaurant:</strong> {{ order.Restaurant }}</p>
        <p><strong>Placed on:</strong> {{ order.Order_Date }}</p>
      </div>
    </div>

    <h5>Items</h5>
    {% if items %}
      <ul class="list-group mb-3">
        {% for it in items %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">{{ it.MenuName }}</div>
              <small class="text-muted">Qty: {{ it.Quantity }}</small>
            </div>
            <div>₹{{ it.Price }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="mb-3 text-muted">No itemized data available.</div>
    {% endif %}

    <h5>Deliveries</h5>
    {% if deliveries %}
      <ul class="list-group">
        {% for d in deliveries %}
          <li class="list-group-item">
            <div><strong>Driver ID:</strong> {{ d.Driver_ID or 'N/A' }} - <strong>Location:</strong> {{ d.Location }}</div>
            <div class="text-muted">Pickup: {{ d.Pickup_Time }} | Fee: ₹{{ d.Fee or '0.00' }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="text-muted">No deliveries recorded for this order.</div>
    {% endif %}

  {% endif %}

  <div class="mt-4">
    <a class="btn btn-outline-secondary" href="{{ url_for('orders') }}">
      <i class="fas fa-arrow-left"></i> Back to Orders
    </a>
    {% if order %}
    <form method="POST" action="{{ url_for('delete_order', order_id=order.Order_ID) }}" style="display:inline;">
      <button type="submit" class="btn btn-danger" onclick="return confirm('Delete order #{{ order.Order_ID }}? This will also delete all associated items and deliveries. This action cannot be undone.')">
        <i class="fas fa-trash"></i> Delete Order
      </button>
    </form>
    {% endif %}
  </div>

{% endblock %}
